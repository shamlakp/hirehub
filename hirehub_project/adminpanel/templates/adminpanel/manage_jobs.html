{% extends 'base.html' %}
{% block content %}
<div class="container mt-4" style="max-width: 800px;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h4 fw-bold mb-0">Manage Jobs</h2>
  </div>

  <ul class="app-list">
    {% for job in jobs %}
    <li class="app-list-item" id="job-row-{{ job.id }}">
      <div class="app-list-icon">
        ğŸ¢
      </div>
      <div class="app-list-content">
        <div class="mb-1">
          <input type="text" class="form-control border-0 p-0 fw-bold bg-transparent" id="title-{{ job.id }}"
            value="{{ job.position }}" style="font-size: 1rem;">
        </div>
        <div class="d-flex align-items-center text-muted">
          <small class="me-2">{{ job.company.company_name }}</small> â€¢
          <input type="text" class="form-control border-0 p-0 ms-2 bg-transparent text-muted small"
            id="location-{{ job.id }}" value="{{ job.location }}" style="width: 150px; display: inline-block;">
        </div>
      </div>
      <div class="app-list-action">
        <button class="btn btn-sm btn-light text-primary rounded-circle" onclick="editJob('{{ job.id }}')" title="Save">
          ğŸ’¾
        </button>
        <button class="btn btn-sm btn-light text-danger rounded-circle" onclick="deleteJob('{{ job.id }}')"
          title="Delete">
          ğŸ—‘ï¸
        </button>
      </div>
    </li>
    {% empty %}
    <li class="app-list-item justify-content-center py-5 text-muted">
      No jobs found.
    </li>
    {% endfor %}
  </ul>
</div>

<script>
  function editJob(jobId) {
    const title = document.getElementById(`title-${jobId}`).value;
    const location = document.getElementById(`location-${jobId}`).value;

    fetch(`/adminpanel/job/${jobId}/ajax-edit/`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title, location })
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert("Job updated successfully!");
        } else {
          alert("Error: " + JSON.stringify(data.errors || data.error));
        }
      });
  }

  function deleteJob(jobId) {
    if (confirm("Are you sure you want to delete this job?")) {
      fetch(`/adminpanel/job/${jobId}/ajax-delete/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Content-Type': 'application/json'
        }
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            document.getElementById(`job-row-${jobId}`).remove();
            alert("Job deleted successfully!");
          } else {
            alert("Error: " + data.error);
          }
        });
    }
  }
</script>
{% endblock %}